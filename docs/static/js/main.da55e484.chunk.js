(this["webpackJsonpwolke-admin"]=this["webpackJsonpwolke-admin"]||[]).push([[0],{75:function(e,t,n){},76:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(10),c=n.n(s),o=(n(75),n(11)),i=n(44),u=(n(76),n(115)),l=n(62),d=n(124),j=n(55),h=n(56),b="https://wolke.glencoden.de",O="".concat(b,"/auth"),m="".concat(b,"/cards");function f(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}var v=new(function(){function e(){Object(j.a)(this,e),this._oAuth2_access_token="",this._adminPassword=""}return Object(h.a)(e,[{key:"_get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(b,"/test/auth"),t={"Content-Type":"application/json; charset=utf-8"};return this._oAuth2_access_token&&(t.Authorization="Bearer ".concat(this._oAuth2_access_token)),Promise.resolve().then((function(){return fetch(e,{method:"GET",headers:t})})).then(f)}},{key:"_post",value:function(e,t){var n={"Content-Type":"application/json; charset=utf-8"};return this._oAuth2_access_token&&(n.Authorization="Bearer ".concat(this._oAuth2_access_token)),Promise.resolve().then((function(){return JSON.stringify(t)})).then((function(t){return fetch(e,{method:"POST",headers:n,body:t})})).then(f)}},{key:"_postEncodeURI",value:function(e,t){return Promise.resolve().then((function(){return function(e){var t=[];for(var n in e){var r=encodeURIComponent(n),a=encodeURIComponent(e[n]);t.push("".concat(r,"=").concat(a))}return t.join("&")}(t)})).then((function(t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:t})})).then(f)}},{key:"loginToWolke",value:function(e){var t=this,n=e.username,r=e.password;return this._postEncodeURI("".concat(O,"/login"),{username:n,password:r,grant_type:"password",client_id:null,client_secret:null}).then((function(e){return t._oAuth2_access_token=e.access_token,t._adminPassword=r,{success:!0}}))}},{key:"logout",value:function(){var e=this;return new Promise((function(t){e._oAuth2_access_token="",e._adminPassword="",t()}))}},{key:"getOAuthUsers",value:function(){return this._post("".concat(O,"/get_all"),{admin_password:this._adminPassword})}},{key:"registerOAuthUser",value:function(e){var t=e.username,n=e.password;return this._post("".concat(O,"/register"),{username:t,password:n,admin_password:this._adminPassword,grant_type:"password"})}},{key:"deleteOAuthUser",value:function(e){var t=e.username;return this._post("".concat(O,"/delete"),{username:t,admin_password:this._adminPassword,grant_type:"password"})}},{key:"getCardsUsers",value:function(){return this._get("".concat(m,"/all_users"))}},{key:"registerCardsUser",value:function(e){var t=e.name,n=e.isAdmin,r=e.from,a=e.to;return this._post("".concat(m,"/upsert_user"),{name:t,isAdmin:n,from:r,to:a,admin_password:this._adminPassword})}},{key:"deleteCardsUser",value:function(e){var t=e.name;return this._post("".concat(m,"/delete_user"),{name:t,admin_password:this._adminPassword})}}]),e}()),x=n(111),p=n(49),g=n(120),_=n(4);var k=function(e){var t=e.onSuccess,n=e.setAlert,a=Object(r.useState)(""),s=Object(o.a)(a,2),c=s[0],i=s[1],l=Object(r.useState)(""),d=Object(o.a)(l,2),j=d[0],h=d[1];return Object(_.jsx)("div",{className:"feature-box",children:Object(_.jsxs)(x.a,{variant:"outlined",className:"action-box",children:[Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"Login"}),Object(_.jsx)(g.a,{label:"username",value:c,onChange:function(e){var t=e.target;return i(t.value)}}),Object(_.jsx)(g.a,{type:"password",label:"password",value:j,onChange:function(e){var t=e.target;return h(t.value)}})]}),Object(_.jsx)("div",{className:"elements-box",children:Object(_.jsx)(u.a,{variant:"contained",onClick:function(){v.loginToWolke({username:c,password:j}).then((function(e){e.success?t(j):n({title:"Login failed",error:e})})).catch((function(e){return n({title:"request error",error:e})}))},children:"Login"})})]})})};var A=function(e){var t=e.setAlert,n=Object(r.useState)(""),a=Object(o.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(""),l=Object(o.a)(i,2),d=l[0],j=l[1],h=Object(r.useState)(""),b=Object(o.a)(h,2),O=b[0],m=b[1],f=Object(r.useState)([]),k=Object(o.a)(f,2),A=k[0],C=k[1],w=Object(r.useCallback)((function(){v.getOAuthUsers().then((function(e){e.success?C(e.users):t({title:"Failed to get oAuth2 users",error:e})})).catch((function(e){return t({title:"request error",error:e})}))}),[t]);return Object(r.useEffect)((function(){return w()}),[w]),Object(_.jsxs)("div",{className:"feature-box",children:[Object(_.jsxs)(x.a,{variant:"outlined",className:"action-box",children:[Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"Register OAuth2 User"}),Object(_.jsx)(g.a,{label:"name",value:s,onChange:function(e){var t=e.target;return c(t.value)}}),Object(_.jsx)(g.a,{label:"password",value:d,onChange:function(e){var t=e.target;return j(t.value)}})]}),Object(_.jsx)("div",{className:"elements-box",children:Object(_.jsx)(u.a,{variant:"contained",onClick:function(){v.registerOAuthUser({username:s,password:d}).then((function(e){e.success?(c(""),j(""),console.log(e),t({title:"Registered oAuth2 user"}),w()):t({title:"Failed to register oAuth2 user",error:e})})).catch((function(e){return t({title:"request error",error:e})}))},children:"Register"})})]}),Object(_.jsxs)(x.a,{variant:"outlined",className:"action-box",children:[Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"Delete OAuth2 User"}),Object(_.jsx)(g.a,{label:"name",value:O,onChange:function(e){var t=e.target;return m(t.value)}})]}),Object(_.jsx)("div",{className:"elements-box",children:Object(_.jsx)(u.a,{variant:"contained",onClick:function(){v.deleteOAuthUser({username:O}).then((function(e){e.success?(m(""),t({title:"Deleted oAuth2 user"}),w()):t({title:"Failed to delete oAuth2 user",error:e})})).catch((function(e){return t({title:"request error",error:e})}))},children:"Delete"})})]}),Object(_.jsx)(x.a,{variant:"outlined",className:"action-box",children:Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"All Users"}),A.map((function(e,t){return Object(_.jsx)(p.a,{className:"list-item",color:"textSecondary",variant:"caption",children:e.username},t)}))]})})]})},C=n(116),w=n(122);function N(e){return e.split(", ")}var y=function(e){var t=e.setAlert,n=Object(r.useState)(""),a=Object(o.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(""),l=Object(o.a)(i,2),d=l[0],j=l[1],h=Object(r.useState)(""),b=Object(o.a)(h,2),O=b[0],m=b[1],f=Object(r.useState)(!1),k=Object(o.a)(f,2),A=k[0],y=k[1],S=Object(r.useState)(""),U=Object(o.a)(S,2),P=U[0],T=U[1],R=Object(r.useState)([]),E=Object(o.a)(R,2),D=E[0],F=E[1],q=Object(r.useCallback)((function(){v.getCardsUsers().then((function(e){e.success?F(e.users):t({title:"Failed to get cards users",error:e})})).catch((function(e){return t({title:"request error",error:e})}))}),[t]);return Object(r.useEffect)((function(){return q()}),[q]),Object(_.jsxs)("div",{className:"feature-box",children:[Object(_.jsxs)(x.a,{variant:"outlined",className:"action-box",children:[Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"Register Cards User"}),Object(_.jsx)(g.a,{label:"name",value:s,onChange:function(e){var t=e.target;return c(t.value)}}),Object(_.jsx)(g.a,{label:"from",value:d,onChange:function(e){var t=e.target;return j(t.value)}}),Object(_.jsx)(g.a,{label:"to",value:O,onChange:function(e){var t=e.target;return m(t.value)}}),Object(_.jsx)(C.a,{control:Object(_.jsx)(w.a,{checked:A,onChange:function(){return y((function(e){return!e}))},name:"checkedA"}),label:"is admin"})]}),Object(_.jsx)("div",{className:"elements-box",children:Object(_.jsx)(u.a,{variant:"contained",onClick:function(){v.registerCardsUser({name:s,from:N(d),to:N(O),isAdmin:A}).then((function(e){e.success?(c(""),j(""),m(""),y(!1),t({title:"Registered cards user ".concat(e.user.name)}),q()):t({title:"Failed to register cards user",error:e})})).catch((function(e){return t({title:"request error",error:e})}))},children:"Register"})})]}),Object(_.jsxs)(x.a,{variant:"outlined",className:"action-box",children:[Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"Delete Cards User"}),Object(_.jsx)(g.a,{label:"name",value:P,onChange:function(e){var t=e.target;return T(t.value)}})]}),Object(_.jsx)("div",{className:"elements-box",children:Object(_.jsx)(u.a,{variant:"contained",onClick:function(){v.deleteCardsUser({name:P}).then((function(e){e.success?(T(""),t({title:"Deleted cards user"}),q()):t({title:"Failed to delete cards user",error:e})})).catch((function(e){return t({title:"request error",error:e})}))},children:"Delete"})})]}),Object(_.jsx)(x.a,{variant:"outlined",className:"action-box",children:Object(_.jsxs)("div",{className:"elements-box",children:[Object(_.jsx)(p.a,{children:"All Users"}),D.map((function(e,t){return Object(_.jsx)(p.a,{className:"list-item",color:"textSecondary",variant:"caption",children:e.name},t)}))]})})]})},S=n(123),U=n(117),P=n(118),T=n(119);var R,E=function(e){var t=e.alert,n=e.reset,a=t.title,s=t.text,c=t.error,o=t.time;Object(r.useEffect)((function(){if(a||s){var e=setTimeout(n,1e3*(c?60:o||2));return function(){return clearTimeout(e)}}}),[n,a,s,c,o]);var i=!!a||!!s,u=[];if(c)for(var l in c){var d=c[l];"string"!==typeof d&&"number"!==typeof d||u.push("".concat(l,": ").concat(d))}return Object(_.jsxs)(S.a,{open:i,onClick:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[!!a&&Object(_.jsx)(U.a,{id:"alert-dialog-title",className:c?"alert-error":"",children:a}),Object(_.jsx)(P.a,{children:Object(_.jsxs)(T.a,{id:"alert-dialog-description",children:[!!s&&Object(_.jsx)(p.a,{children:s}),!!u.length&&u.map((function(e,t){return Object(_.jsx)(p.a,{children:e},t)}))]})})]})},D={NONE:"none",OAUTH2:"oauth2",CARDS:"cards"},F=Object.values(D),q=(R={},Object(i.a)(R,D.NONE,null),Object(i.a)(R,D.OAUTH2,A),Object(i.a)(R,D.CARDS,y),R),I=function(){return{title:"",text:"",error:null}};var B=function(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(null),c=Object(o.a)(s,2),i=c[0],j=c[1],h=Object(r.useState)(F[0]),b=Object(o.a)(h,2),O=b[0],m=b[1],f=Object(r.useState)(I),x=Object(o.a)(f,2),p=x[0],g=x[1],A=q[O],C=function(e){var t=e.target.innerText;F.includes(t)&&m(t),j(null)},w=function(){g({title:"You're logged out"}),a(!1)};return Object(_.jsxs)("div",{className:"App",children:[n?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("div",{className:"top-line",children:[Object(_.jsx)(u.a,{variant:"contained",color:"primary","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){j(e.currentTarget)},children:O}),Object(_.jsx)(l.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:C,children:F.map((function(e,t){return Object(_.jsx)(d.a,{onClick:C,children:e},t)}))}),Object(_.jsx)(u.a,{variant:"contained",onClick:function(){return v.logout().then(w)},children:"Logout"})]}),A&&Object(_.jsx)(A,{setAlert:g})]}):Object(_.jsx)(k,{onSuccess:function(e){a(!0)},setAlert:g}),Object(_.jsx)(E,{alert:p,reset:function(){return g(I)}})]})};c.a.render(Object(_.jsx)(a.a.StrictMode,{children:Object(_.jsx)(B,{})}),document.getElementById("root"))}},[[83,1,2]]]);
//# sourceMappingURL=main.da55e484.chunk.js.map